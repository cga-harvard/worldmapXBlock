{% extends "fullscreen.html" %}
{% load i18n %}
{% block title %} {% trans "Map Viewer" %} - {{ block.super }} {% endblock %}

{% block head %}
{% include "geonode/ext_header.html" %}
{% include "geonode/app_header.html" %}
{% include "geonode/geo_header.html" %}
{% include "geonode/xblock_header.html" %}
{{ block.super }}
{% if "gme-" in GOOGLE_API_KEY %}
<script src="https://www.google.com/jsapi?client={{GOOGLE_API_KEY}}"></script>
{% else %}
<script src="https://www.google.com/jsapi?key={{GOOGLE_API_KEY}}"></script>
{% endif %}
<script type="text/javascript">
    google.load("earth", "1");
</script>

<script src='/static/geonode/externals/ext/resources/xblocktools.js'></script>

<script type="text/javascript">

var app;

var XB = XB || {};  // global used for xblock adapter scripts

Ext.onReady(function() {
{% autoescape off %}
    var config = {
        useCapabilities: false,
        tools: [{
            ptype: "gxp_wmsgetfeatureinfo",
            // uncomment the line below if you want feature info in a grid
            format: "grid",
            actionTarget: "main.tbar",
            outputConfig: {width: 400, height: 200, panIn: false}
        },
            {
                ptype: "gxp_coordinatetool",
                title: "<span class='x-btn-text'>{% trans 'Map Coordinates - longitude, latitude' %}</span>",
                actionTarget: {target: "main.tbar"}
            },
            {
                ptype: "gxp_annotation",
                user: "{{ user.id }}",
                toggleGroup: 'featureGroup',
                actionTarget: {target: "main.tbar", index: 6}
            }
        ],
        createTools: function() {
            return [new Ext.Button({
                tooltip: GeoExplorer.prototype.backgroundContainerText,
                iconCls: 'icon-layer-switcher',
                menu: new gxp.menu.LayerMenu({
                    layers: this.mapPanel.layers
                })
            })]
        },
        proxy: "/proxy/?url=",
        siteUrl: "{{ SITE_URL }}",

        /* The URL to a REST map configuration service.  This service
         * provides listing and, with an authenticated user, saving of
         * maps on the server for sharing and editing.
         */
        rest: "/maps/"
    };

    Ext.apply(config, {{ config }});
      
    
    app = new GeoExplorer.Viewer(config);

//********************************************* XBLOCK RELATED CODE ********************************************
//useful for debugging...
XB.MESSAGING.getInstance().registerHandler("info", function (m) {
    alert("INFO: the slave code received this 'info' message: " + m.getMessage());
});

app.on("ready", XB.xblocktools);
{% endautoescape %}
});
</script>
{% endblock %}
{% block body %}
{% endblock %}
